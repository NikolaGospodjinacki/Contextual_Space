# Contextual Space - Project Instructions

> **This file is the single source of truth for all architectural, technological, and development decisions.**
> **Read this file before making any changes. Update this file when decisions change.**

---

## ðŸŽ¯ Project Overview

**Name:** Contextual Space  
**Type:** Real-time collaborative text placement web application  
**Timeline:** 3-4 days (MVP/POC)  
**Target Users:** Small group (< 50 concurrent users)  
**Primary Goal:** Users can place, edit, and delete text boxes on a shared canvas visible to all connected users in real-time.

---

## ðŸ—ï¸ Architecture Decisions

### Technology Stack (LOCKED IN)

| Layer | Technology | Justification |
|-------|------------|---------------|
| **Frontend** | React 18 + TypeScript + Vite | Fast build, excellent DX, huge ecosystem, best training data |
| **Styling** | Tailwind CSS | Minimalistic, modern, fast iteration |
| **Real-time** | Socket.IO | Simple WebSocket abstraction, handles reconnection |
| **Backend** | Node.js + Express + TypeScript | Same language as frontend, fast development |
| **Database** | Amazon DynamoDB | Serverless, pay-per-request, NoSQL fits the data model |
| **Auth** | Amazon Cognito (simple) OR JWT-only for MVP | Cost-efficient, AWS-native |
| **Container Runtime** | Docker + Docker Compose (local) | Consistent environments |
| **AWS Compute** | AWS App Runner OR ECS Fargate | Simplest container hosting for POC |
| **CDN/Static** | AWS CloudFront + S3 | Frontend hosting |
| **DNS** | AWS Route 53 | Domain management |
| **IaC** | Terraform | Infrastructure as code |
| **CI/CD** | GitHub Actions | Native to repo, free tier generous |

### Architecture Pattern
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CloudFront    â”‚â”€â”€â”€â”€â–¶â”‚   S3 (Static)   â”‚     â”‚   Route 53      â”‚
â”‚   (CDN)         â”‚     â”‚   React App     â”‚     â”‚   (DNS)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ API requests + WebSocket
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App Runner    â”‚â”€â”€â”€â”€â–¶â”‚   DynamoDB      â”‚
â”‚   (Backend)     â”‚     â”‚   (Database)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“ Project Structure (FOLLOW THIS)

```
Contextual_Space/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml              # Lint, test, build
â”‚       â”œâ”€â”€ deploy-infra.yml    # Terraform apply
â”‚       â””â”€â”€ deploy-app.yml      # Build & push containers
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ terraform/
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”œâ”€â”€ variables.tf
â”‚   â”‚   â”œâ”€â”€ outputs.tf
â”‚   â”‚   â”œâ”€â”€ dynamodb.tf
â”‚   â”‚   â”œâ”€â”€ apprunner.tf
â”‚   â”‚   â”œâ”€â”€ s3-cloudfront.tf
â”‚   â”‚   â””â”€â”€ route53.tf
â”‚   â””â”€â”€ docker/
â”‚       â””â”€â”€ (Dockerfiles if needed separately)
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts            # Entry point
â”‚   â”‚   â”œâ”€â”€ server.ts           # Express + Socket.IO setup
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â””â”€â”€ tests/
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.tsx
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â””â”€â”€ tests/
â”œâ”€â”€ docker-compose.yml          # Local development
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ plan.md
â”œâ”€â”€ .copilot-instructions.md    # THIS FILE
â””â”€â”€ README.md
```

---

## ðŸ”’ Core Principles (NEVER VIOLATE)

1. **KISS (Keep It Simple, Stupid)** - Choose the simplest solution that works
2. **Docker Everything** - Every service runs in a container, even locally
3. **Infrastructure as Code** - No manual AWS console changes for infra
4. **Feedback Loop First** - Get something running locally before AWS deployment
5. **Cost Efficiency** - Use pay-per-use services, avoid reserved capacity
6. **Type Safety** - TypeScript everywhere, no `any` types unless absolutely necessary
7. **Single Source of Truth** - This file for architecture, code for implementation

---

## ðŸ“Š Data Model

### DynamoDB Tables

**Table: `contextual-space-textboxes`**
```
PK: CANVAS#{canvasId}
SK: TEXTBOX#{textboxId}
Attributes:
  - textboxId: string (UUID)
  - canvasId: string (default: "main")
  - userId: string
  - username: string
  - content: string
  - positionX: number
  - positionY: number
  - createdAt: string (ISO8601)
  - updatedAt: string (ISO8601)
  - color: string (hex)

GSI1: userId-index
  - GSI1PK: USER#{userId}
  - GSI1SK: TEXTBOX#{textboxId}
```

**Table: `contextual-space-users`** (if auth needed)
```
PK: USER#{userId}
SK: PROFILE
Attributes:
  - userId: string
  - username: string
  - email: string
  - createdAt: string
```

---

## ðŸš€ Development Phases

### Phase 1: Local Development Setup (Day 1 - PRIORITY)
- [ ] Initialize frontend (Vite + React + TypeScript)
- [ ] Initialize backend (Express + Socket.IO + TypeScript)
- [ ] Docker Compose for local dev
- [ ] Basic canvas with text box placement
- [ ] In-memory storage (no DB yet)
- [ ] **MILESTONE: Can place text boxes locally**

### Phase 2: Core Features (Day 1-2)
- [ ] Real-time sync with Socket.IO
- [ ] DynamoDB integration (local DynamoDB in Docker)
- [ ] CRUD operations for text boxes
- [ ] Cursor position sharing
- [ ] **MILESTONE: Real-time works locally with persistence**

### Phase 3: Infrastructure (Day 2-3)
- [ ] Terraform base setup
- [ ] DynamoDB table creation
- [ ] App Runner for backend
- [ ] S3 + CloudFront for frontend
- [ ] GitHub Actions CI/CD
- [ ] **MILESTONE: Deployed to AWS, accessible via URL**

### Phase 4: Polish (Day 3-4)
- [ ] Route 53 custom domain
- [ ] Simple authentication (optional)
- [ ] UI polish
- [ ] Error handling
- [ ] **MILESTONE: Production-ready MVP**

---

## ðŸ› ï¸ Commands Reference

### Local Development
```bash
# Start everything locally
docker-compose up --build

# Frontend only (dev mode)
cd frontend && npm run dev

# Backend only (dev mode)
cd backend && npm run dev

# Run tests
npm test
```

### Infrastructure
```bash
# Initialize Terraform
cd infrastructure/terraform && terraform init

# Plan changes
terraform plan -var-file="dev.tfvars"

# Apply changes
terraform apply -var-file="dev.tfvars"
```

---

## âš ï¸ Decision Log

| Date | Decision | Rationale |
|------|----------|-----------|
| 2025-11-26 | React + Vite over Next.js | Simpler for canvas app, no SSR needed |
| 2025-11-26 | App Runner over ECS | Simpler deployment for POC |
| 2025-11-26 | DynamoDB over Aurora | Pay-per-request, no idle costs |
| 2025-11-26 | Socket.IO over AWS API Gateway WebSockets | Simpler to implement, works with App Runner |

---

## ðŸš¨ When to Ask the User

**ALWAYS ask before:**
1. Adding a new AWS service not listed above
2. Changing the tech stack
3. Adding dependencies > 1MB
4. Making breaking API changes
5. Spending money (domains, services with upfront costs)
6. Major architectural changes

**Proceed without asking:**
1. Fixing bugs
2. Adding TypeScript types
3. Refactoring within existing patterns
4. Adding tests
5. Documentation updates

---

## ðŸ’° Cost Considerations

**Target Monthly Cost: < $20 for POC usage**

| Service | Expected Cost |
|---------|---------------|
| DynamoDB (on-demand) | ~$0-2 |
| App Runner | ~$5-10 (minimum) |
| S3 | ~$0.50 |
| CloudFront | ~$0-1 |
| Route 53 | ~$0.50/zone + $12/year domain |

---

## ðŸ§ª Testing Strategy

- **Unit Tests:** Jest for both frontend and backend
- **Integration Tests:** Supertest for API endpoints
- **E2E Tests:** Optional (Playwright if time permits)
- **Manual Testing:** Primary method for MVP

---

## ðŸ“ Code Style

- **Formatting:** Prettier (default config)
- **Linting:** ESLint with TypeScript rules
- **Naming:** camelCase for variables/functions, PascalCase for components/classes
- **Files:** kebab-case for filenames
- **Commits:** Conventional commits (`feat:`, `fix:`, `chore:`, etc.)

---

## ðŸ”„ Real-time Events (Socket.IO)

```typescript
// Client -> Server
'textbox:create'   { content, positionX, positionY }
'textbox:update'   { textboxId, content?, positionX?, positionY? }
'textbox:delete'   { textboxId }
'cursor:move'      { positionX, positionY }

// Server -> Client
'textbox:created'  { textbox }
'textbox:updated'  { textbox }
'textbox:deleted'  { textboxId }
'cursor:moved'     { userId, username, positionX, positionY }
'sync:initial'     { textboxes: [], cursors: [] }
```

---

**Last Updated:** 2025-11-26  
**Version:** 1.0.0
